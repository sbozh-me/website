# 0.4.5 - PDF Export

## Goal

Add direct PDF generation capability for downloadable CV exports.

## Deliverables

- [ ] PDF generator
- [ ] API route `/api/cv/pdf`
- [ ] Download button component
- [ ] PDF styling consistency with web view

## Files to Create

```
packages/pmdxjs/src/
  pdf/
    index.ts
    generator.ts
  __tests__/
    pdf/
      generator.test.ts

apps/web/
  app/api/cv/pdf/
    route.ts                      # PDF download endpoint
  components/cv/
    CVDownloadButton.tsx          # Download button
```

## PDF Generation Options

Decision to be made at this milestone:

### Option A: Puppeteer (Recommended for pixel-perfect)

```json
{
  "dependencies": {
    "puppeteer": "^22.0.0"
  }
}
```

```typescript
import puppeteer from 'puppeteer';

export async function generatePDF(html: string): Promise<Buffer> {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.setContent(html);
  const pdf = await page.pdf({ format: 'A4', printBackground: true });
  await browser.close();
  return pdf;
}
```

### Option B: @react-pdf/renderer (Lighter, but separate component tree)

```json
{
  "dependencies": {
    "@react-pdf/renderer": "^3.4.4"
  }
}
```

```typescript
import { Document, Page, Text, View } from '@react-pdf/renderer';

export function CVPDFDocument({ ast }) {
  return (
    <Document>
      <Page size="A4">
        {/* Transform AST to react-pdf components */}
      </Page>
    </Document>
  );
}
```

## API Route

```typescript
// app/api/cv/pdf/route.ts
import { NextResponse } from 'next/server';
import { generatePDF } from '@sbozh/pmdxjs/pdf';
import cvContent from '@/content/cv.pmdx';

export async function GET() {
  const pdfBuffer = await generatePDF(cvContent);

  return new NextResponse(pdfBuffer, {
    headers: {
      'Content-Type': 'application/pdf',
      'Content-Disposition': 'attachment; filename="cv.pdf"'
    }
  });
}
```

## Download Button

```typescript
// components/cv/CVDownloadButton.tsx
export function CVDownloadButton() {
  return (
    <a
      href="/api/cv/pdf"
      download="cv.pdf"
      className={cn(
        "inline-flex items-center gap-2 px-4 py-2",
        "bg-primary text-primary-foreground rounded-md",
        "hover:bg-primary/90 transition-colors"
      )}
    >
      <DownloadIcon className="w-4 h-4" />
      Download PDF
    </a>
  );
}
```

## Demo

- Download button on CV page
- Clicking downloads formatted PDF
- PDF matches web view styling
- Proper A4 page format

## Acceptance Criteria

- [ ] PDF generation creates valid PDF buffer
- [ ] All CV sections present in PDF
- [ ] API endpoint returns correct headers
- [ ] PDF styling matches web view
- [ ] Generation completes within acceptable time (<5s)
- [ ] Test coverage >= 90%
