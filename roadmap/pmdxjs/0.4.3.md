# 0.4.3 - MDX Browser Runtime

## Goal

Enable browser-side rendering via @mdx-js/mdx for dynamic CV editing capabilities.

## Deliverables

- [ ] Browser compiler (`compile()` function)
- [ ] Server compiler (Next.js SSR compatible)
- [ ] Component mapping for MDX scope
- [ ] `usePMDXJS` hook (loading/error/Component states)
- [ ] Error boundary wrapper

## Files to Create

```
packages/pmdxjs/src/
  runtime/
    index.ts
    browser.ts
    server.ts
    components.ts
    error-boundary.tsx
  hooks/
    index.ts
    usePMDXJS.ts
  __tests__/
    runtime/
      browser.test.ts
      server.test.ts
    hooks/
      usePMDXJS.test.tsx
```

## Dependencies

```json
{
  "dependencies": {
    "@mdx-js/mdx": "^3.0.1",
    "@mdx-js/react": "^3.0.1"
  }
}
```

## API Design

### Server Compilation

```typescript
import { compile } from '@sbozh/pmdxjs/runtime/server';

// In Next.js RSC
const CVComponent = await compile(cvSource);
```

### Browser Compilation

```typescript
import { compile } from '@sbozh/pmdxjs/runtime/browser';

const Component = await compile(source);
```

### React Hook

```typescript
import { usePMDXJS } from '@sbozh/pmdxjs/hooks';

function Editor() {
  const [source, setSource] = useState(defaultCV);
  const { loading, error, Component } = usePMDXJS(source);

  return (
    <div className="flex">
      <textarea value={source} onChange={e => setSource(e.target.value)} />
      <div className="preview">
        {loading && <Spinner />}
        {error && <ErrorDisplay message={error.message} />}
        {Component && <Component />}
      </div>
    </div>
  );
}
```

## Demo

Live editor with real-time preview:
- Textarea for PMDXJS source
- Real-time rendered CV preview
- Error messages for invalid syntax

## Acceptance Criteria

- [ ] Browser compilation produces renderable component
- [ ] Server compilation works with Next.js SSR
- [ ] Same output on server and client (hydration safe)
- [ ] usePMDXJS handles loading/error/success states
- [ ] Parse errors produce meaningful messages
- [ ] Test coverage >= 90%
