# 0.6.0 - Directus Setup

## Goal

Set up Directus CMS with Docker, PostgreSQL, and Redis for local development.

## Deliverables

- [ ] Docker compose with PostgreSQL + Redis + Directus
- [ ] Environment template with all required variables
- [ ] README section for starting Directus locally
- [ ] Verify Directus admin panel accessible at localhost:8055

## Files to Create

```
apps/web/
  directus/
    docker-compose.yaml       # Dev: Directus + PostgreSQL + Redis
    .env.example              # Environment template
    .gitignore                # Ignore .env, volumes
```

## docker-compose.yaml Structure

```yaml
services:
  database:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: directus
      POSTGRES_PASSWORD: directus
      POSTGRES_DB: directus
    volumes:
      - ./data/database:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U directus"]
      interval: 10s
      timeout: 5s
      retries: 5

  cache:
    image: redis:7-alpine
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  directus:
    image: directus/directus:11.3.0
    ports:
      - "8055:8055"
    depends_on:
      database: { condition: service_healthy }
      cache: { condition: service_healthy }
    environment:
      SECRET: ${DIRECTUS_SECRET}
      DB_CLIENT: pg
      DB_HOST: database
      DB_PORT: 5432
      DB_DATABASE: directus
      DB_USER: directus
      DB_PASSWORD: directus
      CACHE_ENABLED: true
      CACHE_STORE: redis
      REDIS: redis://cache:6379
      ADMIN_EMAIL: ${ADMIN_EMAIL}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}
      PUBLIC_URL: http://localhost:8055
      CORS_ENABLED: true
      CORS_ORIGIN: http://localhost:3000
      WEBSOCKETS_ENABLED: true
      EXTENSIONS_AUTO_RELOAD: true
    volumes:
      - ./data/uploads:/directus/uploads
```

## Environment Variables (.env.example)

```bash
# Directus Admin
DIRECTUS_SECRET=change-this-to-random-32-char-string
ADMIN_EMAIL=admin@sbozh.me
ADMIN_PASSWORD=change-in-production

# For Next.js
DIRECTUS_URL=http://localhost:8055
DIRECTUS_TOKEN=  # Static token for API access (create in Directus admin)
```

## .gitignore

```
.env
data/
```

## Acceptance Criteria

- [ ] `docker compose up` starts all 3 services without errors
- [ ] PostgreSQL healthcheck passes
- [ ] Redis healthcheck passes
- [ ] Directus admin panel accessible at http://localhost:8055
- [ ] Can login with ADMIN_EMAIL/ADMIN_PASSWORD
- [ ] Environment template documented
- [ ] Data persists across container restarts
