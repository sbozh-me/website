# 0.5.0 - Package Scaffold + Types + Data Layer

## Goal

Establish `@sbozh/blog` package foundation with TypeScript types and abstract data layer (repository pattern).

## Deliverables

- [ ] Package structure following `@sbozh/react-ui` patterns
- [ ] TypeScript interfaces for Persona, Post, Tag
- [ ] Abstract data layer interface (BlogRepository)
- [ ] Mock repository implementation for development
- [ ] Unit tests for data layer

## Data Types

```ts
interface Persona {
  id: string;
  name: string;        // "The Founder", "Semenus", etc.
  slug: string;        // "founder", "semenus", etc.
  color: string;       // hex color, e.g. "#8b5cf6"
  description?: string;
}

interface Tag {
  id: string;
  name: string;
  slug: string;
}

interface Post {
  id: string;
  title: string;
  slug: string;
  excerpt: string;
  content: string;     // MDX content
  date: string;        // ISO date
  readingTime: number; // minutes
  persona: Persona;
  tags: Tag[];
}

interface PostListItem {
  id: string;
  title: string;
  slug: string;
  excerpt: string;
  date: string;
  readingTime: number;
  persona: Persona;
  tags: Tag[];
}

interface PostFilters {
  persona?: string;    // persona slug
  tag?: string;        // tag slug
  year?: number;       // e.g., 2025
}
```

## Data Layer Architecture

```
┌─────────────────────────────────────────────────────┐
│                   Components                         │
│            (consume data via props)                  │
└─────────────────────┬───────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────┐
│              BlogRepository (interface)              │
│  getPosts(filters?) → PostListItem[]                │
│  getPost(slug) → Post | null                        │
│  getPersonas() → Persona[]                          │
│  getTags() → Tag[]                                  │
└─────────────────────┬───────────────────────────────┘
                      │
         ┌────────────┴────────────┐
         ▼                         ▼
┌─────────────────┐      ┌─────────────────┐
│ MockRepository  │      │ DirectusRepo    │
│   (0.5.0)       │      │   (0.6.0)       │
└─────────────────┘      └─────────────────┘
```

## Files to Create

```
packages/blog/
  package.json
  tsconfig.json
  vitest.config.ts
  src/
    index.ts
    types/
      index.ts
      persona.ts
      post.ts
      tag.ts
      filters.ts
    data/
      index.ts
      repository.ts         # BlogRepository interface
      mock-repository.ts    # Mock implementation
      mock-data.ts          # Sample posts/personas/tags
    __tests__/
      data/
        mock-repository.test.ts
```

## Dependencies

```json
{
  "devDependencies": {
    "@sbozh/typescript-config": "workspace:*",
    "@sbozh/eslint-config": "workspace:*",
    "vitest": "^4.0.15",
    "typescript": "^5.7.2"
  },
  "peerDependencies": {
    "react": "^19.0.0"
  }
}
```

## Repository Interface

```typescript
// src/data/repository.ts
export interface BlogRepository {
  getPosts(filters?: PostFilters): Promise<PostListItem[]>;
  getPost(slug: string): Promise<Post | null>;
  getPersonas(): Promise<Persona[]>;
  getTags(): Promise<Tag[]>;
}
```

## Mock Implementation

```typescript
// src/data/mock-repository.ts
import { mockPosts, mockPersonas, mockTags } from './mock-data';

export class MockBlogRepository implements BlogRepository {
  async getPosts(filters?: PostFilters): Promise<PostListItem[]> {
    let posts = [...mockPosts];

    if (filters?.persona) {
      posts = posts.filter(p => p.persona.slug === filters.persona);
    }
    if (filters?.tag) {
      posts = posts.filter(p => p.tags.some(t => t.slug === filters.tag));
    }
    if (filters?.year) {
      posts = posts.filter(p => new Date(p.date).getFullYear() === filters.year);
    }

    return posts.sort((a, b) =>
      new Date(b.date).getTime() - new Date(a.date).getTime()
    );
  }

  async getPost(slug: string): Promise<Post | null> {
    return mockPosts.find(p => p.slug === slug) ?? null;
  }

  async getPersonas(): Promise<Persona[]> {
    return mockPersonas;
  }

  async getTags(): Promise<Tag[]> {
    return mockTags;
  }
}
```

## Mock Data (Sample)

```typescript
// src/data/mock-data.ts
export const mockPersonas: Persona[] = [
  { id: '1', name: 'The Founder', slug: 'founder', color: '#8b5cf6' },
  { id: '2', name: 'Kagurame Sbozh', slug: 'kagurame', color: '#f59e0b' },
  { id: '3', name: 'Semenus', slug: 'semenus', color: '#22c55e' },
  { id: '4', name: 'The Dude', slug: 'dude', color: '#06b6d4' },
];

export const mockTags: Tag[] = [
  { id: '1', name: 'Tech', slug: 'tech' },
  { id: '2', name: 'Startup', slug: 'startup' },
  { id: '3', name: 'Philosophy', slug: 'philosophy' },
  { id: '4', name: 'Personal', slug: 'personal' },
];

export const mockPosts: Post[] = [
  {
    id: '1',
    title: 'Why I started sbozh.me',
    slug: 'why-i-started-sbozh',
    excerpt: 'From side project to personal startup. The story of building something that matters...',
    content: '# Why I started sbozh.me\n\nLong form content here...',
    date: '2025-12-04',
    readingTime: 5,
    persona: mockPersonas[0],
    tags: [mockTags[0], mockTags[1]],
  },
  // ... more sample posts
];
```

## Demo

```typescript
import { MockBlogRepository } from '@sbozh/blog/data';
import type { BlogRepository } from '@sbozh/blog/data';

// Use interface for dependency injection
const repository: BlogRepository = new MockBlogRepository();

// Fetch all posts
const posts = await repository.getPosts();

// Filter by persona
const founderPosts = await repository.getPosts({ persona: 'founder' });

// Get single post
const post = await repository.getPost('why-i-started-sbozh');
```

## Acceptance Criteria

- [ ] `pnpm test` passes in packages/blog
- [ ] `pnpm build` succeeds
- [ ] Types exported and importable
- [ ] BlogRepository interface defined
- [ ] MockBlogRepository implements interface correctly
- [ ] Filtering works (persona, tag, year)
- [ ] Mock data includes 4+ sample posts across personas
- [ ] Test coverage >= 90%
