# 0.5.3 - Post Page Components

## Goal

Create React components for the blog post page: header, prose typography, table of contents, and code blocks.

## Deliverables

- [ ] `PostHeader` component (persona, title, meta)
- [ ] `TableOfContents` component (sticky TOC)
- [ ] `Prose` component (article typography)
- [ ] Code block styling with forge syntax theme
- [ ] `PostLayout` wrapper component
- [ ] TOC generation utility

## Files to Create

```
packages/blog/src/
  components/
    post/
      index.ts
      PostLayout.tsx
      PostHeader.tsx
      TableOfContents.tsx
      Prose.tsx
  utils/
    toc.ts                # extractHeadings()
  styles/
    prose.css
    code.css
    toc.css
  __tests__/
    components/
      post/
        PostHeader.test.tsx
        TableOfContents.test.tsx
        Prose.test.tsx
    utils/
      toc.test.ts
```

## Component Specs

### PostLayout

```typescript
interface PostLayoutProps {
  children: React.ReactNode;
  toc?: TOCItem[];
}
```

Layout structure:
```
┌──────────────────────────────────────────────────────────────┐
│                                                              │
│  [Header]                                                    │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  [Article content]                        [TOC (sticky)]     │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

```tsx
<article className="max-w-2xl mx-auto lg:max-w-4xl lg:grid lg:grid-cols-[1fr_200px] lg:gap-8">
  <div className="prose-content">
    {children}
  </div>
  {toc && toc.length > 0 && (
    <aside className="hidden lg:block">
      <TableOfContents items={toc} />
    </aside>
  )}
</article>
```

### PostHeader

```typescript
interface PostHeaderProps {
  post: Post;
}
```

Layout:
```
● The Founder                               ← Persona with color

Why I started sbozh.me                      ← Title (h1)

Dec 4, 2025 • 5 min read • Tech, Startup   ← Meta
```

```tsx
<header className="mb-12">
  {/* Persona */}
  <div className="flex items-center gap-2 mb-4">
    <PersonaDot color={post.persona.color} name={post.persona.name} showName />
  </div>

  {/* Title */}
  <h1 className="text-3xl font-bold mb-4">{post.title}</h1>

  {/* Meta */}
  <div className="text-sm text-muted-foreground flex gap-3">
    <span>{formatDate(post.date)}</span>
    <span>•</span>
    <span>{post.readingTime} min read</span>
    <span>•</span>
    <span>{post.tags.map(t => t.name).join(', ')}</span>
  </div>
</header>
```

### TableOfContents

```typescript
interface TOCItem {
  id: string;
  text: string;
  level: number; // 2 or 3 (h2, h3)
}

interface TableOfContentsProps {
  items: TOCItem[];
}
```

Sticky on scroll, highlights active section:

```css
.toc {
  position: sticky;
  top: 100px;
  max-height: calc(100vh - 200px);
  overflow-y: auto;
}

.toc-item {
  font-size: 0.875rem;
  color: var(--muted-foreground);
  padding: 4px 0;
  border-left: 2px solid transparent;
  padding-left: 12px;
  transition: all 150ms ease;
}

.toc-item:hover {
  color: var(--foreground);
}

.toc-item.active {
  color: var(--primary);
  border-left-color: var(--primary);
}

/* Indent h3 items */
.toc-item[data-level="3"] {
  padding-left: 24px;
}
```

Active section tracking:
```tsx
// Use IntersectionObserver to track which heading is in view
const [activeId, setActiveId] = useState<string | null>(null);

useEffect(() => {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          setActiveId(entry.target.id);
        }
      });
    },
    { rootMargin: '-100px 0px -80% 0px' }
  );

  // Observe all headings
  items.forEach(item => {
    const el = document.getElementById(item.id);
    if (el) observer.observe(el);
  });

  return () => observer.disconnect();
}, [items]);
```

### Prose

Article typography wrapper:

```typescript
interface ProseProps {
  children: React.ReactNode;
  className?: string;
}
```

```css
.prose {
  font-size: 1.125rem;      /* 18px */
  line-height: 1.8;
  color: var(--foreground);
}

.prose h2 {
  font-size: 1.5rem;
  font-weight: 600;
  margin-top: 48px;
  margin-bottom: 16px;
  color: var(--foreground);
}

.prose h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin-top: 32px;
  margin-bottom: 12px;
}

.prose p {
  margin-bottom: 24px;
}

.prose a {
  color: var(--primary);
  text-decoration: underline;
  text-underline-offset: 2px;
}

.prose blockquote {
  border-left: 3px solid var(--primary);
  padding-left: 20px;
  font-style: italic;
  color: var(--muted-foreground);
  margin: 32px 0;
}

.prose ul, .prose ol {
  padding-left: 24px;
  margin-bottom: 24px;
}

.prose li {
  margin-bottom: 8px;
}

.prose img {
  width: 100%;
  border-radius: 8px;
  margin: 32px 0;
}

.prose figcaption {
  text-align: center;
  font-size: 0.875rem;
  color: var(--muted-foreground);
  margin-top: -24px;
  margin-bottom: 32px;
}
```

### Code Blocks

Forge syntax highlighting theme:

```css
.prose pre {
  background: #0f0f14;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
  overflow-x: auto;
  margin: 32px 0;
}

.prose code {
  font-family: var(--font-mono);
  font-size: 0.9rem;
}

/* Inline code */
.prose :not(pre) > code {
  background: var(--muted);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.875em;
}

/* Syntax highlighting - Forge theme */
.token.keyword { color: #8b5cf6; }    /* purple */
.token.string { color: #22c55e; }     /* green */
.token.function { color: #f59e0b; }   /* gold */
.token.comment { color: #6b7280; }    /* muted */
.token.variable { color: #e5e7eb; }   /* foreground */
.token.number { color: #06b6d4; }     /* cyan */
.token.operator { color: #9ca3af; }   /* gray */
```

## Utility Functions

### TOC Extraction

```typescript
// utils/toc.ts
interface TOCItem {
  id: string;
  text: string;
  level: number;
}

function extractHeadings(content: string): TOCItem[];

// Parses MDX content and extracts h2/h3 headings
// Generates slugified IDs: "My Heading" → "my-heading"
```

## Demo

```typescript
import {
  PostLayout,
  PostHeader,
  Prose,
  TableOfContents
} from '@sbozh/blog/components';
import { extractHeadings } from '@sbozh/blog/utils';

function PostPage({ post }) {
  const toc = extractHeadings(post.content);

  return (
    <PostLayout toc={toc}>
      <PostHeader post={post} />
      <Prose>
        <MDXContent />
      </Prose>
    </PostLayout>
  );
}
```

## Acceptance Criteria

- [ ] PostHeader displays persona (colored), title, date, reading time, tags
- [ ] TableOfContents renders h2/h3 items
- [ ] TOC is sticky on scroll (desktop)
- [ ] Active section highlighted in TOC
- [ ] Prose typography is readable (18px, 1.8 line-height)
- [ ] Code blocks use forge syntax colors
- [ ] Inline code styled differently from blocks
- [ ] Images full width with captions
- [ ] Links are purple (primary color)
- [ ] Blockquotes have left border
- [ ] Test coverage >= 90%
