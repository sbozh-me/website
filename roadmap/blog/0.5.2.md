# 0.5.2 - Filter Components

## Goal

Implement filter bar with dropdowns for date, tags, and persona filtering.

## Deliverables

- [ ] `FilterBar` container component
- [ ] `Select` dropdown component (themed)
- [ ] `DateFilter` component
- [ ] `TagFilter` component
- [ ] `PersonaFilter` component
- [ ] `SearchPlaceholder` component (for future Algolia integration)
- [ ] Filter state management hook

## Files to Create

```
packages/blog/src/
  components/
    filters/
      index.ts
      FilterBar.tsx
      Select.tsx
      DateFilter.tsx
      TagFilter.tsx
      PersonaFilter.tsx
      SearchPlaceholder.tsx
  hooks/
    index.ts
    usePostFilters.ts
  __tests__/
    components/
      filters/
        FilterBar.test.tsx
        Select.test.tsx
    hooks/
      usePostFilters.test.ts
```

## Component Specs

### FilterBar

```typescript
interface FilterBarProps {
  personas: Persona[];
  tags: Tag[];
  filters: PostFilters;
  onFiltersChange: (filters: PostFilters) => void;
}
```

Layout:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Date â–¼]  [Tags â–¼]  [Persona â–¼]           ğŸ” Search   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```tsx
<div className="filters flex gap-4 mb-8">
  <DateFilter value={filters.year} onChange={...} />
  <TagFilter tags={tags} value={filters.tag} onChange={...} />
  <PersonaFilter personas={personas} value={filters.persona} onChange={...} />
  <div className="ml-auto">
    <SearchPlaceholder />
  </div>
</div>
```

### Select (Base Component)

Themed dropdown matching Obsidian Forge:

```typescript
interface SelectProps {
  placeholder: string;
  value?: string;
  options: SelectOption[];
  onChange: (value: string | undefined) => void;
}

interface SelectOption {
  value: string;
  label: string;
  color?: string; // For persona colors
}
```

Styles:
```css
.select {
  background: var(--muted);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 0.875rem;
  color: var(--foreground);
  min-width: 120px;
}

.select:focus {
  outline: none;
  ring: 2px solid var(--primary);
}

.select-option {
  padding: 8px 12px;
}

.select-option:hover {
  background: var(--accent);
}
```

### DateFilter

```typescript
interface DateFilterProps {
  value?: number; // year
  onChange: (year?: number) => void;
}
```

Options:
- All time (undefined)
- This year (current year)
- This month (current month)
- Dynamic year options from posts data

### TagFilter

```typescript
interface TagFilterProps {
  tags: Tag[];
  value?: string; // tag slug
  onChange: (tagSlug?: string) => void;
}
```

Options:
- All tags (undefined)
- Dynamic list from props

### PersonaFilter

```typescript
interface PersonaFilterProps {
  personas: Persona[];
  value?: string; // persona slug
  onChange: (personaSlug?: string) => void;
}
```

Options render with persona color:
```tsx
{personas.map(persona => (
  <Option
    key={persona.id}
    value={persona.slug}
    style={{ color: persona.color }}
  >
    <span
      className="w-2 h-2 rounded-full mr-2"
      style={{ backgroundColor: persona.color }}
    />
    {persona.name}
  </Option>
))}
```

### SearchPlaceholder

Placeholder icon for future search integration:

```tsx
<div className="flex items-center gap-2 text-muted-foreground cursor-not-allowed">
  <SearchIcon className="w-4 h-4" />
  <span className="text-sm">Search</span>
</div>
```

## Hooks

### usePostFilters

```typescript
interface UsePostFiltersReturn {
  filters: PostFilters;
  setFilter: (key: keyof PostFilters, value: string | number | undefined) => void;
  clearFilters: () => void;
  hasActiveFilters: boolean;
}

function usePostFilters(initialFilters?: PostFilters): UsePostFiltersReturn;
```

URL sync (optional enhancement):
- Persist filters to URL query params
- `?persona=founder&year=2025`

## Demo

```typescript
import { FilterBar, usePostFilters } from '@sbozh/blog';

function BlogPage({ personas, tags, posts }) {
  const { filters, setFilter, clearFilters } = usePostFilters();

  const filteredPosts = useMemo(() => {
    return posts.filter(post => {
      if (filters.persona && post.persona.slug !== filters.persona) return false;
      if (filters.tag && !post.tags.some(t => t.slug === filters.tag)) return false;
      if (filters.year && new Date(post.date).getFullYear() !== filters.year) return false;
      return true;
    });
  }, [posts, filters]);

  return (
    <>
      <FilterBar
        personas={personas}
        tags={tags}
        filters={filters}
        onFiltersChange={setFilter}
      />
      <Timeline posts={filteredPosts} />
    </>
  );
}
```

## Acceptance Criteria

- [ ] FilterBar displays all three filter dropdowns + search placeholder
- [ ] Select component matches Obsidian Forge theme
- [ ] DateFilter shows year options
- [ ] TagFilter shows tags from props
- [ ] PersonaFilter shows personas with colored dots
- [ ] Filters update state correctly
- [ ] usePostFilters hook manages filter state
- [ ] Clearing filters resets to "all"
- [ ] Test coverage >= 90%
