# 0.7.1 - Robots & Sitemap

## Goal

Configure crawling rules and generate dynamic sitemap from Directus content.

## Deliverables

- [ ] robots.ts with sitemap reference
- [ ] sitemap.ts fetching blog posts from Directus
- [ ] Include all public routes: /, /blog, /blog/[slug], /cv

## Implementation

### Robots Configuration

```typescript
// apps/web/app/robots.ts
import { MetadataRoute } from 'next';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
    },
    sitemap: 'https://sbozh.me/sitemap.xml',
  };
}
```

### Dynamic Sitemap

```typescript
// apps/web/app/sitemap.ts
import { MetadataRoute } from 'next';
import { createBlogRepository } from '@/lib/blog/repository';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const baseUrl = 'https://sbozh.me';

  // Static pages
  const staticPages: MetadataRoute.Sitemap = [
    {
      url: baseUrl,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 1,
    },
    {
      url: `${baseUrl}/blog`,
      lastModified: new Date(),
      changeFrequency: 'weekly',
      priority: 0.8,
    },
    {
      url: `${baseUrl}/cv`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.8,
    },
  ];

  // Dynamic blog posts
  let blogPosts: MetadataRoute.Sitemap = [];
  try {
    const repository = createBlogRepository();
    const posts = await repository.getPosts();

    blogPosts = posts.map((post) => ({
      url: `${baseUrl}/blog/${post.slug}`,
      lastModified: new Date(post.date),
      changeFrequency: 'monthly' as const,
      priority: 0.6,
    }));
  } catch {
    // If Directus unavailable, return only static pages
  }

  return [...staticPages, ...blogPosts];
}
```

## Files to Create

| File | Action |
|------|--------|
| `apps/web/app/robots.ts` | NEW |
| `apps/web/app/sitemap.ts` | NEW |

## Acceptance Criteria

- [ ] /robots.txt returns proper robots configuration
- [ ] /sitemap.xml lists all pages
- [ ] Blog posts appear in sitemap with correct URLs
- [ ] Sitemap generation doesn't fail if Directus is down
- [ ] Dates formatted correctly in sitemap
